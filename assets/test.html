<!DOCTYPE html>
<html style="background-image: url(bg.jpg); background-position: bottom right;">
	<head>
		<script type="text/javascript" src='jquery.js'></script>
		<link rel="stylesheet" type="text/css" href="desktopIcon.css" />
		<script type="text/javascript" src="desktopIcon.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<style type="text/css">
			body {
				position: absolute;
				left: 0px;
				right: 0px;
				bottom: 0px;
				top: 0px;
				display: flex;
				flex-wrap: wrap;
				flex-direction: column;
				align-items: flex-start;
				align-content: flex-start;
			}
		</style>
	</head>
	<body>
		<!--textarea style="resize: none" rows="3"></textarea-->

	<script>

		function selectElementContents(el) {
		    var range = document.createRange();
		    range.selectNodeContents(el);
		    var sel = window.getSelection();
		    sel.removeAllRanges();
		    sel.addRange(range);
		}

		$(document).on('mousedown', '.icon:not(.icon-selected)', function() {
			$('.icon-selected').removeClass('icon-selected');
			$(this).addClass('icon-selected')
		});

		$(document).on('keydown', function(event) {

			var selected = $('.icon-selected');
			if (!selected.length) return;

			if (event.which === 27) {
				$('.icon-rename', selected).remove();
				return false;
			}


			else if (event.which === 13) {
		
				var renamer = $('.icon-rename', selected);
		
				if (renamer.length) {
					var text = renamer.text();
					renamer.closest('.icon').data('text', text);
					renamer.remove();
					var splittedText = fitText(text);
					$('.icon-firstLine', selected).html(splittedText[0] || '');
					$('.icon-secondLine', selected).html(splittedText[1] || '');
					$('.icon-thirdLine', selected).html(splittedText[2] || '');
				}

				else {
					var h = $('.icon-firstLine', selected)[0].offsetHeight * 3;
					var foo = $(`<div class="icon-rename" style="max-height: ${h}px; " contenteditable="true">${selected.data('text')}</div>`);
					foo.prependTo($('.icon-lines', selected))
					foo.focus();
					selectElementContents(foo[0])
				}

				return false;
			}






			// .focus();



		});


		$(document).on('input', '.myAREA', function() {

			var lines = 1;
			var splitted = splitText(this.innerText, maxTextWidth);
			
			if (splitted[1]) {
				lines++;
				splitted = splitText(splitted[1], maxTextWidth);
				if (splitted[1]) {
					lines++;
				}
			}

			$(this).css({
				// height: lines * (fontSize * 1)
			})
		});



		


		function generate_random_string(string_length){
		    let random_string = '';
		    let random_ascii;
		    for(let i = 0; i < string_length; i++) {
		        random_ascii = Math.floor((Math.random() * 25) + 97);
		        random_string += String.fromCharCode(random_ascii)
		    }
		    return random_string
		}


		for (var c = 0; c < 30; c++) { 
			addIcon(generate_random_string(Math.floor(Math.random() * 60) + 4) + '.jpg');
		}


	</script>

</body>
</html>